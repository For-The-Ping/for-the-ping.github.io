<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ForThePing — Word Runner</title>

  <style>
    :root{
      --bg:#0b0f19;
      --text:#e5e7eb;
      --muted:#94a3b8;

      --goodFill: rgba(59,130,246,.18);
      --goodStroke: rgba(59,130,246,.55);
      --goodText: rgba(191,219,254,.98);

      --badFill: rgba(239,68,68,.16);
      --badStroke: rgba(239,68,68,.58);
      --badText: rgba(254,202,202,.98);
    }

    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto;
    }

    header{
      max-width:980px;
      margin:auto;
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    button{
      background:#1f2937;
      border:1px solid #374151;
      color:white;
      padding:8px 14px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
    }

    canvas{
      display:block;
      margin:0 auto;
      border-radius:12px;
      background:#0b0f19;
      box-shadow:0 10px 30px rgba(0,0,0,.45);
    }

    footer{
      text-align:center;
      padding:16px;
      color:var(--muted);
      font-size:12px;
    }
  </style>
</head>

<body>

<header>
  <strong>ForThePing — Word Runner</strong>
  <div>
    <button onclick="start()">Démarrer</button>
    <button onclick="reset()">Reset</button>
  </div>
</header>

<canvas id="cv" width="960" height="540"></canvas>

<footer>
  Aucune donnée ne sort de ton navigateur (localStorage)
</footer>

<script>
/* =========================
   CONFIG
========================= */
const W = 960, H = 540;
const PLAYER_R = 12;
const PLAYER_SPEED = 2.4;
const MAX_LIVES = 3;
const INVULN_SEC = 1.2;

const GOOD_WORDS = [
  "Architecture","Infrastructure","Réseau","Télécommunication","Résilience",
  "Performance","Stabilité","Continuité","Optimisation","Efficacité",
  "Gouvernance","Vision","Décision","Alignement","Clarté","Fiabilité"
];

const BAD_WORDS = [
  "Flou","Jargon inutile","Complexité inutile","Surcouche",
  "Rapports embellis","Parler pour ne rien dire","Vendre du rêve"
];

let redirectArmed = false;

/* =========================
   CANVAS
========================= */
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");

const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* =========================
   GAME STATE
========================= */
const game = {
  running:false,
  over:false,
  score:0,
  level:1,
  lives:MAX_LIVES,
  invuln:0,
  time:0,
  player:{ x:W/2, y:H/2 },
  goods:[],
  enemies:[]
};

/* =========================
   LEADERBOARD
========================= */
const LB_KEY = "ftp_word_runner_lb";

function saveScore(){
  const arr = JSON.parse(localStorage.getItem(LB_KEY)||"[]");
  arr.push({
    score:game.score,
    level:game.level,
    date:new Date().toLocaleString()
  });
  arr.sort((a,b)=>b.score-a.score);
  localStorage.setItem(LB_KEY, JSON.stringify(arr.slice(0,8)));
}

/* =========================
   GAME FLOW
========================= */
function reset(){
  redirectArmed = false;
  game.running = false;
  game.over = false;
  game.score = 0;
  game.level = 1;
  game.lives = MAX_LIVES;
  game.invuln = 0;
  game.time = 0;
  game.player = { x:W/2, y:H/2 };
  spawnLevel();
  draw();
}

function start(){
  if(game.over) reset();
  game.running = true;
  lastT = performance.now();
  requestAnimationFrame(loop);
}

function gameOver(){
  if (redirectArmed) return;
  redirectArmed = true;

  game.running = false;
  game.over = true;

  saveScore();
  draw();

  setTimeout(() => {
    window.location.assign("https://fortheping.com/");
  }, 1200);
}

/* =========================
   SPAWN
========================= */
function spawnLevel(){
  game.goods = [];
  game.enemies = [];

  for(let i=0;i<3;i++) spawnGood();
  for(let i=0;i<2+game.level;i++) spawnEnemy();
}

function spawnGood(){
  game.goods.push({
    label:GOOD_WORDS[Math.floor(Math.random()*GOOD_WORDS.length)],
    x:Math.random()*(W-200)+50,
    y:Math.random()*(H-50)+25
  });
}

function spawnEnemy(){
  game.enemies.push({
    label:BAD_WORDS[Math.floor(Math.random()*BAD_WORDS.length)],
    x:Math.random()*W,
    y:Math.random()*H,
    vx:0,
    vy:0,
    speed:80+game.level*20
  });
}

/* =========================
   LOOP
========================= */
let lastT = 0;

function loop(t){
  if(!game.running) return;
  const dt = (t-lastT)/1000;
  lastT = t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

/* =========================
   UPDATE
========================= */
function update(dt){
  game.time += dt;
  if(game.invuln>0) game.invuln-=dt;

  let vx=0,vy=0;
  if(keys.ArrowLeft||keys.a) vx-=PLAYER_SPEED;
  if(keys.ArrowRight||keys.d) vx+=PLAYER_SPEED;
  if(keys.ArrowUp||keys.w) vy-=PLAYER_SPEED;
  if(keys.ArrowDown||keys.s) vy+=PLAYER_SPEED;

  game.player.x=Math.max(PLAYER_R,Math.min(W-PLAYER_R,game.player.x+vx));
  game.player.y=Math.max(PLAYER_R,Math.min(H-PLAYER_R,game.player.y+vy));

  for(const e of game.enemies){
    const dx=game.player.x-e.x;
    const dy=game.player.y-e.y;
    const d=Math.hypot(dx,dy)||1;
    e.vx=(dx/d)*e.speed;
    e.vy=(dy/d)*e.speed;
    e.x+=e.vx*dt;
    e.y+=e.vy*dt;

    if(game.invuln<=0 && Math.hypot(e.x-game.player.x,e.y-game.player.y)<PLAYER_R+12){
      game.lives--;
      game.invuln=INVULN_SEC;
      game.player={x:W/2,y:H/2};
      if(game.lives<=0) return gameOver();
    }
  }

  for(let i=game.goods.length-1;i>=0;i--){
    const g=game.goods[i];
    if(Math.hypot(g.x-game.player.x,g.y-game.player.y)<PLAYER_R+40){
      game.goods.splice(i,1);
      game.score+=150;
      if(game.score%600===0){
        game.level++;
        spawnLevel();
      }else spawnGood();
    }
  }
}

/* =========================
   DRAW
========================= */
function draw(){
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#0b0f19";
  ctx.fillRect(0,0,W,H);

  ctx.fillStyle="white";
  ctx.fillText(`Score: ${game.score}`,12,20);
  ctx.fillText(`Niveau: ${game.level}`,12,40);
  ctx.fillText(`Vies: ${game.lives}`,12,60);

  for(const g of game.goods){
    ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--goodFill");
    ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--goodStroke");
    ctx.fillRect(g.x-40,g.y-14,120,26);
    ctx.strokeRect(g.x-40,g.y-14,120,26);
    ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--goodText");
    ctx.fillText(g.label,g.x-32,g.y+5);
  }

  for(const e of game.enemies){
    ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--badFill");
    ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--badStroke");
    ctx.fillRect(e.x-50,e.y-14,140,26);
    ctx.strokeRect(e.x-50,e.y-14,140,26);
    ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--badText");
    ctx.fillText(e.label,e.x-42,e.y+5);
  }

  ctx.beginPath();
  ctx.arc(game.player.x,game.player.y,PLAYER_R,0,Math.PI*2);
  ctx.fillStyle="#ff6ad5";
  ctx.fill();
}

reset();
</script>

</body>
</html>
